<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Firebase Authentication Example</title>
  <script src="https://www.gstatic.com/firebasejs/9.11.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.11.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.11.0/firebase-firestore.js"></script>
</head>
<body>
  <h1>Login Example</h1>

  <!-- Display the user's name after login -->
  <div id="welcome-message">Please sign in</div>

  <!-- Buttons for different sign-in methods -->
  <button id="google-signin">Sign In with Google</button>
  <button id="anonymous-signin">Sign In Anonymously</button>
  
  <!-- Optional: Add Email/Password sign-in if needed -->
  <br><br>
  <label for="email">Email:</label>
  <input type="email" id="email" placeholder="Email" />
  <label for="password">Password:</label>
  <input type="password" id="password" placeholder="Password" />
  <button id="email-signin">Sign In with Email</button>

  <script>
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
      appId: "YOUR_APP_ID",
      measurementId: "YOUR_MEASUREMENT_ID"
    };

    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // Google Sign-In Function
    const provider = new firebase.auth.GoogleAuthProvider();
    document.getElementById("google-signin").addEventListener("click", () => {
      firebase.auth().signInWithPopup(provider)
        .then((result) => {
          const user = result.user;
          saveUserName(user);
        })
        .catch((error) => {
          console.error("Error during Google Sign-In:", error);
        });
    });

    // Anonymous Sign-In Function
    document.getElementById("anonymous-signin").addEventListener("click", () => {
      firebase.auth().signInAnonymously()
        .then(() => {
          const user = auth.currentUser;
          saveUserName(user);
        })
        .catch((error) => {
          console.error("Error during Anonymous Sign-In:", error);
        });
    });

    // Email/Password Sign-In
    document.getElementById("email-signin").addEventListener("click", () => {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      firebase.auth().signInWithEmailAndPassword(email, password)
        .then((userCredential) => {
          const user = userCredential.user;
          saveUserName(user);
        })
        .catch((error) => {
          console.error("Error during Email/Password Sign-In:", error);
        });
    });

    // Save User Name to Firestore and LocalStorage
    function saveUserName(user) {
      const userName = user.displayName || user.email || 'Anonymous';

      // Store the user's name in Firebase Firestore
      db.collection("users").doc(user.uid).set({
        name: userName
      })
      .then(() => {
        console.log("User name saved to Firestore");
      })
      .catch((error) => {
        console.error("Error saving user name to Firestore:", error);
      });

      // Store the user's name in LocalStorage
      localStorage.setItem('userName', userName);

      // Display the user's name
      document.getElementById('welcome-message').textContent = `Welcome, ${userName}!`;
    }

    // Check for stored user name in LocalStorage on page load
    window.onload = function() {
      const storedName = localStorage.getItem('userName');
      if (storedName) {
        document.getElementById('welcome-message').textContent = `Welcome back, ${storedName}!`;
      }
    };
  </script>
</body>
</html>
